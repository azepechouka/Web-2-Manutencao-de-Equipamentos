<section class="container-fluid mt-4 px-4">
  <h2 class="mb-4 fw-semibold">Minhas Solicitações</h2>

  <div *ngIf="carregando" class="text-muted mb-2">Carregando…</div>

  <div *ngIf="erro" class="alert alert-danger mb-3">
    {{ erro }}
  </div>

  <div *ngIf="!carregando && !erro && itens.length > 0; else vazio">
    <table class="table table-striped table-hover align-middle w-100 shadow-sm">
      <thead class="table-light text-center">
        <tr>
          <th style="width: 12%">Data/Hora</th>
          <th style="width: 25%">Equipamento</th>
          <th style="width: 15%">Categoria</th>
          <th style="width: 15%">Status</th>
          <th style="width: 20%">Ação</th>
          <th style="width: 13%">Visualizar</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of itens" class="text-center">

          <td>{{ item.criadoEm | date: 'dd/MM/yyyy, HH:mm' }}</td>

          <td class="text-start" [title]="item.descricaoEquipamento">
            {{
              item.descricaoEquipamento.length > 30
                ? (item.descricaoEquipamento | slice: 0:30) + '…'
                : item.descricaoEquipamento
            }}
          </td>

          <td>{{ item.categoriaNome }}</td>

          <td>
            <span
              class="badge px-3 py-2 d-inline-block"
              [ngStyle]="{
                backgroundColor: getStatusCor(item.estadoAtual),
                color: '#fff',
                width: '120px',
                textAlign: 'center'
              }"
            >
              {{ item.estadoAtual }}
            </span>
          </td>

          <td>
            <ng-container *ngFor="let acao of getAcoes(item)">
              <button
                type="button"
                class="btn btn-sm"
                [ngClass]="acao.tipo"
                (click)="acao.acao()"
                style="width: 120px;"
              >
                {{ acao.texto }}
              </button>
            </ng-container>
            
            <!-- Caso não tenha ações dinâmicas -->
            <span *ngIf="getAcoes(item).length === 0" class="text-muted">
              -
            </span>
          </td>

          <td>
            <button
              type="button"
              class="btn btn-sm btn-secondary"
              style="width: 120px;"
              (click)="verSolicitacao(item.id)"
            >
              <i class="bi bi-eye"></i> Visualizar
            </button>
          </td>

        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #vazio>
    <p class="text-muted text-center mt-4">Nenhuma solicitação encontrada.</p>
  </ng-template>
</section>