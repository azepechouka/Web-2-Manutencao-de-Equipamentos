<div class="container" style="max-width: 980px; margin: 0 auto; padding: 1rem;">
  <!-- LOADING -->
  <div *ngIf="carregando()" class="text-muted mb-2">Carregando…</div>

  <!-- ERRO -->
  <div *ngIf="erro()" class="alert alert-danger mb-3">
    {{ erro() }}
  </div>

  <!-- CONTEÚDO PRINCIPAL -->
  <ng-container *ngIf="!carregando() && solicitacao() as s">
    <!-- DADOS DA SOLICITAÇÃO -->
    <div class="card mb-3 border rounded shadow-sm">
      <div class="card-header bg-light fw-bold">Dados da Solicitação</div>
      <div class="card-body">
        <p><strong>ID:</strong> {{ s.id }}</p>
        <p><strong>Aberta em:</strong> {{ s.criadoEm | date:'dd/MM/yyyy, HH:mm' }}</p>

        <p>
          <strong>Status atual:</strong>
          <span
            class="badge"
            [ngStyle]="{
              backgroundColor: getStatusCor(s.estadoAtual),
              color: '#fff'
            }"
          >
            {{ s.estadoAtual }}
          </span>
        </p>

        <p><strong>Equipamento:</strong> {{ s.descricaoEquipamento || '—' }}</p>
        <p class="mb-0" style="white-space: pre-line;">
          <strong>Defeito relatado:</strong> {{ s.descricaoDefeito || '—' }}
        </p>
      </div>
    </div>

    <!-- DADOS DO CLIENTE -->
    <div class="card mb-3 border rounded shadow-sm">
      <div class="card-header bg-light fw-bold">Dados do Cliente</div>

      <ng-container *ngIf="cliente() as c; else semCliente">
        <div class="card-body">
          <p><strong>Nome:</strong> {{ c.nome || '—' }}</p>
          <p><strong>E-mail:</strong> {{ c.email || '—' }}</p>
          <p><strong>Telefone:</strong> {{ c.telefone || '—' }}</p>

          <div *ngIf="c.endereco">
            <strong>Endereço:</strong>
            {{ c.endereco.logradouro }}, {{ c.endereco.numero }}
            <span *ngIf="c.endereco.complemento"> - {{ c.endereco.complemento }}</span>,
            {{ c.endereco.bairro }} - {{ c.endereco.localidade }}/{{ c.endereco.uf }}
            — CEP: {{ c.endereco.cep }}
          </div>
        </div>
      </ng-container>

      <ng-template #semCliente>
        <div class="card-body text-muted">Cliente não encontrado.</div>
      </ng-template>
    </div>

    <!-- EFETUAR ORÇAMENTO -->
    <div class="card border rounded shadow-sm">
      <div class="card-header bg-light fw-bold">Efetuar Orçamento (RF012)</div>
      <div class="card-body">
        <form
          [formGroup]="form"
          (ngSubmit)="salvar()"
          class="row g-3 align-items-end"
          style="display: grid; grid-template-columns: 220px 1fr auto; gap: .75rem 1rem;"
        >
          <!-- VALOR -->
          <div>
            <label for="valorTotal" class="form-label">Valor</label>
            <div class="input-group">
              <span class="input-group-text">R$</span>
              <input
                id="valorTotal"
                type="number"
                min="0.01"
                step="0.01"
                formControlName="valorTotal"
                class="form-control"
                placeholder="0,00"
              />
            </div>
            <small
              class="text-danger"
              *ngIf="form.controls.valorTotal.touched && form.controls.valorTotal.invalid"
            >
              Informe um valor maior que zero.
            </small>
          </div>

          <!-- OBSERVAÇÃO -->
          <div>
            <label for="observacao" class="form-label">Observação (opcional)</label>
            <input
              id="observacao"
              type="text"
              formControlName="observacao"
              class="form-control"
              placeholder="Ex.: peças incluídas, mão de obra, garantia..."
            />
          </div>

          <!-- BOTÃO -->
          <div class="text-end">
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="form.invalid"
            >
              Registrar Orçamento
            </button>
          </div>
        </form>
      </div>
    </div>
  </ng-container>
</div>
