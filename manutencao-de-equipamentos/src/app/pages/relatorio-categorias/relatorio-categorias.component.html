<div class="container" style="max-width: 980px; margin: 0 auto; padding: 1rem;">
  <div class="card shadow-sm">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h5 class="m-0">Receita por Categoria (Desde Sempre)</h5>
      <span class="text-muted" *ngIf="vm$ | async as vm">
        {{ vm.qtdGeral }} orçamento(s) — Total:
        <strong>{{ vm.totalGeral | currency:'BRL':'symbol':'1.2-2' }}</strong>
      </span>
    </div>

    <div class="card-body">
      <form class="row g-2 align-items-end mb-2">
        <div class="col-12 col-md-6">
          <label class="form-label">Categoria</label>
          <select class="form-select" [formControl]="filtroCtrl">
            <ng-container *ngIf="opcoes$ | async as opts">
              <option *ngFor="let o of opts" [ngValue]="o.value">{{ o.label }}</option>
            </ng-container>
          </select>
        </div>
        <div class="col-12 col-md-auto">
          <button type="button" class="btn btn-primary" (click)="exportarPDF()">Exportar PDF</button>
        </div>
      </form>
    </div>

    <div class="card-body p-0">
      <ng-container *ngIf="vm$ | async as vm; else carregando">
        <ng-container *ngIf="vm.itens.length; else vazio">
          <div class="table"
               style="display:grid; grid-template-columns: 1fr 160px 140px 160px 160px;">
            <div class="row" style="display:contents;">
              <div class="cell fw-semibold" style="background:#f7f7f7; padding:.6rem .75rem; border-bottom:1px solid #eee;">Categoria</div>
              <div class="cell fw-semibold" style="background:#f7f7f7; padding:.6rem .75rem; border-bottom:1px solid #eee; text-align:right;">Receita (BRL)</div>
              <div class="cell fw-semibold" style="background:#f7f7f7; padding:.6rem .75rem; border-bottom:1px solid #eee; text-align:right;">Qtde Orç.</div>
              <div class="cell fw-semibold" style="background:#f7f7f7; padding:.6rem .75rem; border-bottom:1px solid #eee;">Primeiro Orçamento</div>
              <div class="cell fw-semibold" style="background:#f7f7f7; padding:.6rem .75rem; border-bottom:1px solid #eee;">Último Orçamento</div>
            </div>

            <div class="row" *ngFor="let it of vm.itens; trackBy: trackByCategoria" style="display:contents;">
              <div class="cell" style="padding:.6rem .75rem; border-bottom:1px solid #f2f2f2;">
                {{ it.categoriaDescricao }}
              </div>
              <div class="cell" style="padding:.6rem .75rem; border-bottom:1px solid #f2f2f2; text-align:right;">
                {{ it.total | currency:'BRL':'symbol':'1.2-2' }}
              </div>
              <div class="cell" style="padding:.6rem .75rem; border-bottom:1px solid #f2f2f2; text-align:right;">
                {{ it.quantidade }}
              </div>
              <div class="cell" style="padding:.6rem .75rem; border-bottom:1px solid #f2f2f2;">
                <ng-container *ngIf="it.primeira; else hifen1">{{ it.primeira | date:'short' }}</ng-container>
                <ng-template #hifen1>—</ng-template>
              </div>
              <div class="cell" style="padding:.6rem .75rem; border-bottom:1px solid #f2f2f2;">
                <ng-container *ngIf="it.ultima; else hifen2">{{ it.ultima | date:'short' }}</ng-container>
                <ng-template #hifen2>—</ng-template>
              </div>
            </div>
          </div>
        </ng-container>
      </ng-container>

      <ng-template #carregando>
        <div class="p-3 text-muted">Carregando…</div>
      </ng-template>

      <ng-template #vazio>
        <div class="p-3 text-muted">Nenhum orçamento registrado.</div>
      </ng-template>
    </div>
  </div>
</div>