<div class="container mt-4" *ngIf="!isLoading && solicitacao && orcamento; else loading">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3>Or√ßamento da Solicita√ß√£o</h3>
      <a routerLink="/home" class="btn btn-secondary">Voltar</a>
    </div>

    <div class="card-body">
      <div class="row">
        <!-- üìã Dados da Solicita√ß√£o -->
        <div class="col-md-6">
          <h5 class="mb-3">Detalhes da Solicita√ß√£o</h5>
          <table class="table table-borderless table-sm">
            <tbody>
              <tr><th>Cliente:</th><td>{{ solicitacao.clienteNome }}</td></tr>
              <tr><th>Categoria:</th><td>{{ solicitacao.categoriaNome }}</td></tr>
              <tr><th>Equipamento:</th><td>{{ solicitacao.descricaoEquipamento || '‚Äî' }}</td></tr>
              <tr><th>Defeito:</th><td>{{ solicitacao.descricaoDefeito || '‚Äî' }}</td></tr>
              <tr><th>Data de Abertura:</th><td>{{ solicitacao.criadoEm | date: 'dd/MM/yyyy, HH:mm' }}</td></tr>
              <tr><th>Status Atual:</th><td>{{ solicitacao.estadoAtual }}</td></tr>
            </tbody>
          </table>
        </div>

        <!-- üí∞ Dados do Or√ßamento -->
        <div class="col-md-6">
          <h5 class="mb-3">Informa√ß√µes do Or√ßamento</h5>
          <table class="table table-borderless table-sm">
            <tbody>
              <tr><th>Valor:</th><td><strong>R$ {{ orcamento.valor | number: '1.2-2' }}</strong></td></tr>
              <tr><th>Observa√ß√£o:</th><td>{{ orcamento.observacao || '‚Äî' }}</td></tr>
              <tr><th>Criado em:</th><td>{{ orcamento.criadoEm | date: 'dd/MM/yyyy, HH:mm' }}</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- üë§ Dados do Usu√°rio -->
      <hr />
      <div *ngIf="usuario">
        <h5 class="mb-3">Informa√ß√µes do Cliente</h5>
        <table class="table table-borderless table-sm">
          <tbody>
            <tr><th>Nome:</th><td>{{ usuario.nome }}</td></tr>
            <tr><th>Email:</th><td>{{ usuario.email }}</td></tr>
            <tr><th>Telefone:</th><td>{{ usuario.telefone || '‚Äî' }}</td></tr>
          </tbody>
        </table>
      </div>

      <!-- üìú Hist√≥rico -->
      <hr />
      <div *ngIf="historico.length > 0">
        <h5 class="mb-3">Hist√≥rico de Status</h5>
        <table class="table table-bordered table-sm">
          <thead>
            <tr>
              <th>Data</th>
              <th>Status</th>
              <th>Observa√ß√£o</th>
              <th>Usu√°rio</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of historico">
              <td>{{ item.criadoEm | date: 'dd/MM/yyyy, HH:mm' }}</td>
              <td>{{ item.statusNome || '‚Äî' }}</td>
              <td>{{ item.observacao || '‚Äî' }}</td>
              <td>{{ item.nomeUsuario || '‚Äî' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ‚öôÔ∏è A√ß√µes -->
      <div class="d-flex justify-content-center mt-4 gap-3">
        <button class="btn btn-success" (click)="aceitarOrcamento()" [disabled]="isProcessing">
          <span *ngIf="isProcessing" class="spinner-border spinner-border-sm me-2"></span>
          Aceitar Or√ßamento
        </button>
        <button class="btn btn-danger" (click)="recusarOrcamento()" [disabled]="isProcessing">
          Recusar
        </button>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <p class="text-center mt-5">Carregando informa√ß√µes do or√ßamento...</p>
</ng-template>
