<div class="container-lg py-4">
  
  <div class="text-center mb-4">
    <h2 class="fw-bold">Efetuar Manuten√ß√£o</h2>
    <p class="text-muted">
      Visualize as informa√ß√µes da solicita√ß√£o e registre a manuten√ß√£o realizada.
    </p>
  </div>

  
  <div *ngIf="carregando" class="text-center my-5">
    <div
      class="spinner-border text-primary mb-3"
      style="width: 3rem; height: 3rem"
    ></div>
    <p class="text-muted">Carregando dados da solicita√ß√£o...</p>
  </div>

  
  <div *ngIf="erro" class="alert alert-danger text-center">{{ erro }}</div>

  
  <div *ngIf="!carregando && solicitacao" class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <div class="card shadow-sm border-0">
        <div
          class="card-header bg-white fw-semibold fs-5 border-bottom d-flex align-items-center justify-content-between"
        >
          <span>Dados da Solicita√ß√£o</span>
          <span
            class="badge px-3 py-2 text-uppercase"
            [ngStyle]="{
              backgroundColor: getStatusCor(solicitacao.estadoAtual),
              color: '#fff'
            }"
          >
            {{ solicitacao.estadoAtual }}
          </span>
        </div>

        <div class="card-body">
          <div class="row mb-2">
            <div class="col-sm-6">
              <p class="mb-1"><strong>ID:</strong> {{ solicitacao.id }}</p>
            </div>
            <div class="col-sm-6 text-sm-end">
              <p class="mb-1">
                <strong>Data de Abertura:</strong>
                {{ solicitacao.criadoEm | date: 'dd/MM/yyyy, HH:mm' }}
              </p>
            </div>
          </div>

          <p class="mb-1">
            <strong>Cliente:</strong> {{ solicitacao.clienteNome || '‚Äî' }}
          </p>
          <p class="mb-1">
            <strong>Categoria:</strong> {{ solicitacao.categoriaNome || '‚Äî' }}
          </p>

          <hr />

          <p class="mb-2">
            <strong>Descri√ß√£o do Equipamento:</strong><br />
            <span class="text-muted">{{
              solicitacao.descricaoEquipamento || '‚Äî'
            }}</span>
          </p>

          <p class="mb-0">
            <strong>Descri√ß√£o do Defeito:</strong><br />
            <span class="text-muted">{{
              solicitacao.descricaoDefeito || '‚Äî'
            }}</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  
  <div
    *ngIf="!carregando && solicitacao && !exibirCamposManutencao"
    class="mt-4 d-flex flex-column flex-sm-row justify-content-center gap-3"
  >
    <button
      class="btn btn-primary px-4 py-2 fw-semibold shadow-sm"
      (click)="iniciarManutencao()"
      [disabled]="processando"
    >
      <i class="bi bi-tools me-2"></i> Efetuar Manuten√ß√£o
    </button>

    <button
      class="btn btn-warning text-white px-4 py-2 fw-semibold shadow-sm"
      (click)="redirecionarManutencao()"
      [disabled]="processando"
    >
      <i class="bi bi-arrow-repeat me-2"></i> Redirecionar Manuten√ß√£o
    </button>
  </div>

  
  <div
    *ngIf="exibirCamposManutencao"
    class="card border-0 shadow-sm mt-4 mx-auto"
    style="max-width: 700px"
  >
    <div class="card-header bg-light fw-bold fs-5">
      üõ†Ô∏è Registrar Manuten√ß√£o
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label for="descricao-manutencao" class="form-label fw-semibold"
          >Descri√ß√£o da Manuten√ß√£o:</label
        >
        <textarea
          id="descricao-manutencao"
          #descricaoManutencao
          class="form-control form-control-lg"
          rows="3"
          placeholder="Descreva as a√ß√µes realizadas, pe√ßas trocadas, ajustes feitos..."
        ></textarea>
      </div>

      <div class="mb-3">
        <label for="orientacoes-cliente" class="form-label fw-semibold"
          >Orienta√ß√µes para o Cliente:</label
        >
        <textarea
          id="orientacoes-cliente"
          #orientacoesCliente
          class="form-control form-control-lg"
          rows="3"
          placeholder="Informe recomenda√ß√µes, cuidados ou prazos..."
        ></textarea>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-3">
        <button
          class="btn btn-success px-4 fw-semibold"
          (click)="
            concluirManutencao(
              descricaoManutencao.value,
              orientacoesCliente.value
            )
          "
          [disabled]="processando"
        >
          <span
            *ngIf="processando"
            class="spinner-border spinner-border-sm me-2"
          ></span>
          <i class="bi bi-check2-circle me-1"></i> Concluir
        </button>

        <button
          class="btn btn-outline-secondary px-4 fw-semibold"
          (click)="exibirCamposManutencao = false"
          [disabled]="processando"
        >
          Cancelar
        </button>
      </div>
    </div>
  </div>

  
  <div
    *ngIf="mensagem"
    class="alert alert-info mt-4 text-center mx-auto"
    style="max-width: 700px"
    [innerHTML]="mensagem"
  ></div>
</div>
