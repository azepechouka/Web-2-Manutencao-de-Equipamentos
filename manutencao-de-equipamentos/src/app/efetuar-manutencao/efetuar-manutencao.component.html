<!-- Garanta no index.html -->
<!-- <meta name="viewport" content="width=device-width, initial-scale=1" /> -->

<div class="container-lg py-3">
  <h2 class="mb-4">Efetuar Manutenção</h2>

  <!-- Estado de carregamento -->
  <div *ngIf="carregando" class="text-muted">Carregando dados...</div>

  <!-- Mensagem de erro -->
  <div *ngIf="erro" class="alert alert-danger">{{ erro }}</div>

  <!-- Grid principal: Solicitação + Cliente -->
  <div class="row g-4" *ngIf="!carregando">
    <!-- Dados da Solicitação -->
    <div class="col-12 col-lg-6" *ngIf="solicitacao">
      <div class="card h-100 border rounded shadow-sm">
        <div class="card-header bg-light fw-bold">Dados da Solicitação</div>
        <div class="card-body">
          <p class="mb-2 text-break"><strong>ID:</strong> {{ solicitacao.id }}</p>

          <p class="mb-2">
            <strong>Data de Abertura:</strong>
            {{ solicitacao.criadoEm | date: 'dd/MM/yyyy, HH:mm' }}
          </p>

          <p class="mb-2">
            <strong>Status Atual:</strong>
            <span
              class="badge"
              [ngStyle]="{
                backgroundColor: getStatusCor(solicitacao.estadoAtual),
                color: '#fff'
              }"
            >
              {{ solicitacao.estadoAtual }}
            </span>
          </p>

          <p class="mb-2 text-break">
            <strong>Descrição do Equipamento:</strong>
            {{ solicitacao.descricaoEquipamento || '—' }}
          </p>

          <p class="mb-2 text-break">
            <strong>Categoria do Equipamento:</strong>
            {{ solicitacao.categoriaEquipamento || solicitacao.categoriaNome || '—' }}
          </p>

          <p class="mb-0 text-break">
            <strong>Descrição do Problema:</strong>
            {{ solicitacao.descricaoDefeito || '—' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Dados do Cliente -->
    <div class="col-12 col-lg-6" *ngIf="cliente">
      <div class="card h-100 border rounded shadow-sm">
        <div class="card-header bg-light fw-bold">Dados do Cliente</div>
        <div class="card-body">
          <p class="mb-2 text-break"><strong>Nome:</strong> {{ cliente?.nome || '—' }}</p>
          <p class="mb-2 text-break"><strong>E-mail:</strong> {{ cliente?.email || '—' }}</p>
          <p class="mb-2 text-break"><strong>Telefone:</strong> {{ cliente?.telefone || '—' }}</p>

          <div *ngIf="cliente?.endereco" class="text-break">
            <strong>Endereço:</strong>
            {{ cliente.endereco.logradouro }}, {{ cliente.endereco.numero }}
            <span *ngIf="cliente.endereco.complemento">
              - {{ cliente.endereco.complemento }}
            </span>,
            {{ cliente.endereco.bairro }} -
            {{ cliente.endereco.localidade }}/{{ cliente.endereco.uf }}
            — CEP: {{ cliente.endereco.cep }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ações -->
  <div
    *ngIf="!carregando && solicitacao"
    class="my-4 d-grid d-sm-flex gap-2"
  >
    <button class="btn btn-primary w-100 w-sm-auto" (click)="iniciarManutencao()">
      <i class="bi bi-tools me-1"></i> Efetuar Manutenção
    </button>
    <button class="btn btn-warning text-white w-100 w-sm-auto" (click)="redirecionarManutencao()">
      <i class="bi bi-arrow-repeat me-1"></i> Redirecionar Manutenção
    </button>
  </div>

  <!-- Campos de manutenção -->
  <div *ngIf="exibirCamposManutencao" class="card border rounded shadow-sm mt-4">
    <div class="card-header bg-light fw-bold">Dados da Manutenção</div>
    <div class="card-body">
      <div class="mb-3">
        <label for="descricao-manutencao" class="form-label">Descrição da Manutenção:</label>
        <textarea
          id="descricao-manutencao"
          #descricaoManutencao
          class="form-control"
          rows="3"
          placeholder="Descreva as ações realizadas, peças trocadas, ajustes feitos..."
        ></textarea>
      </div>

      <div class="mb-3">
        <label for="orientacoes-cliente" class="form-label">Orientações para o Cliente:</label>
        <textarea
          id="orientacoes-cliente"
          #orientacoesCliente
          class="form-control"
          rows="3"
          placeholder="Informe recomendações, cuidados ou prazos..."
        ></textarea>
      </div>

      <div class="d-grid d-sm-flex justify-content-end">
        <button
          class="btn btn-success w-100 w-sm-auto"
          (click)="concluirManutencao(descricaoManutencao.value, orientacoesCliente.value)"
        >
          <i class="bi bi-check2-circle me-1"></i> Concluir Manutenção
        </button>
      </div>
    </div>
  </div>

  <!-- Mensagem final -->
  <div *ngIf="mensagem" class="alert alert-info mt-4" [innerHTML]="mensagem"></div>
</div>
